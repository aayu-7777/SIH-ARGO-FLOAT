<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Argo Float RAG Chatbot Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chat-container {
            width: 90%;
            max-width: 800px;
            height: 80vh;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }

        .chat-header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }

        .chat-header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .message {
            max-width: 80%;
            animation: fadeIn 0.3s ease-in;
        }

        .message.user {
            align-self: flex-end;
        }

        .message.assistant {
            align-self: flex-start;
        }

        .message-content {
            padding: 15px 20px;
            border-radius: 20px;
            word-wrap: break-word;
            line-height: 1.5;
        }

        .message.user .message-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }

        .message.assistant .message-content {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #e9ecef;
            border-bottom-left-radius: 5px;
        }

        .typing-indicator {
            display: flex;
            gap: 4px;
            align-items: center;
            padding: 15px 20px;
        }

        .typing-indicator span {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #667eea;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-indicator span:nth-child(1) { animation-delay: -0.32s; }
        .typing-indicator span:nth-child(2) { animation-delay: -0.16s; }

        @keyframes typing {
            0%, 80%, 100% { transform: scale(0.8); opacity: 0.5; }
            40% { transform: scale(1); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .sample-queries {
            padding: 15px 20px;
            background: #f8f9fa;
            border-top: 1px solid #e9ecef;
        }

        .sample-queries h4 {
            margin-bottom: 10px;
            color: #495057;
            font-size: 0.9rem;
        }

        .sample-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .sample-button {
            background: white;
            border: 1px solid #dee2e6;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.2s ease;
            color: #495057;
        }

        .sample-button:hover {
            background: #e9ecef;
            transform: translateY(-1px);
        }

        .chat-input {
            padding: 20px;
            background: white;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 10px;
            align-items: flex-end;
        }

        .chat-input textarea {
            flex: 1;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            padding: 12px 16px;
            font-size: 0.9rem;
            resize: none;
            outline: none;
            font-family: inherit;
            min-height: 44px;
            max-height: 120px;
        }

        .chat-input textarea:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .send-button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }

        .sql-details {
            margin-top: 10px;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            overflow: hidden;
        }

        .sql-details summary {
            background: #f8f9fa;
            padding: 10px;
            cursor: pointer;
            font-weight: 500;
            color: #495057;
        }

        .sql-details pre {
            background: #f8f9fa;
            padding: 15px;
            margin: 0;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            color: #495057;
            overflow-x: auto;
        }

        .data-table {
            margin-top: 10px;
            max-height: 200px;
            overflow: auto;
            border: 1px solid #e9ecef;
            border-radius: 8px;
        }

        .data-table table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.8rem;
        }

        .data-table th,
        .data-table td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
        }

        .error-message {
            color: #dc3545;
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .chat-container {
                width: 95%;
                height: 90vh;
            }
            
            .message {
                max-width: 90%;
            }
            
            .sample-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>ðŸ¤– Argo Float Data Assistant</h1>
            <p>Ask me anything about your oceanographic float data!</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <div class="message assistant">
                <div class="message-content">
                    Hello! I'm your Argo Float data assistant. I can help you query and analyze oceanographic float data. Try asking me things like "Show me all available floats" or "What's the latest location of float 1900816?"
                </div>
            </div>
        </div>

        <div class="sample-queries">
            <h4>Try these sample queries:</h4>
            <div class="sample-buttons">
                <button class="sample-button" onclick="useSampleQuery('Show me all available floats')">Show all floats</button>
                <button class="sample-button" onclick="useSampleQuery('What\'s the latest location of float 1900816?')">Latest location</button>
                <button class="sample-button" onclick="useSampleQuery('What\'s the average temperature for float 1900816?')">Average temperature</button>
                <button class="sample-button" onclick="useSampleQuery('Show me all measurements from 2023')">2023 data</button>
                <button class="sample-button" onclick="useSampleQuery('What floats are in the Atlantic Ocean?')">Atlantic floats</button>
                <button class="sample-button" onclick="useSampleQuery('Show me the temperature range for all floats')">Temperature range</button>
            </div>
        </div>

        <div class="chat-input">
            <textarea 
                id="messageInput" 
                placeholder="Ask me about Argo float data... (e.g., 'Show me all floats' or 'What's the temperature range for float 1900816?')"
                rows="2"
            ></textarea>
            <button class="send-button" id="sendButton" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        let isLoading = false;

        // Sample queries for demo
        const sampleQueries = [
            "Show me all available floats",
            "What's the latest location of float 1900816?",
            "What's the average temperature for float 1900816?",
            "Show me all measurements from 2023",
            "What floats are in the Atlantic Ocean?",
            "Show me the temperature range for all floats",
            "Which float has the highest salinity measurements?",
            "Show me data from floats in the Pacific Ocean",
            "What's the deepest pressure measurement recorded?",
            "Show me monthly averages for float 1900816"
        ];

        function addMessage(content, type, sqlQuery = null, data = null) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            
            let messageContent = `<div class="message-content">${content}</div>`;
            
            if (sqlQuery) {
                messageContent += `
                    <details class="sql-details">
                        <summary>View SQL Query</summary>
                        <pre>${sqlQuery}</pre>
                    </details>
                `;
            }
            
            if (data && data.length > 0) {
                messageContent += `
                    <details class="sql-details">
                        <summary>View Data (${data.length} rows)</summary>
                        <div class="data-table">
                            <table>
                                <thead>
                                    <tr>
                                        ${Object.keys(data[0]).map(key => `<th>${key}</th>`).join('')}
                                    </tr>
                                </thead>
                                <tbody>
                                    ${data.slice(0, 5).map(row => `
                                        <tr>
                                            ${Object.values(row).map(value => `<td>${value === null ? 'null' : value}</td>`).join('')}
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                            ${data.length > 5 ? `<div style="padding: 10px; text-align: center; color: #666;">Showing first 5 of ${data.length} rows</div>` : ''}
                        </div>
                    </details>
                `;
            }
            
            messageDiv.innerHTML = messageContent;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.className = 'message assistant';
            typingDiv.id = 'typingIndicator';
            typingDiv.innerHTML = `
                <div class="typing-indicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            `;
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function hideTyping() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message || isLoading) return;

            // Add user message
            addMessage(message, 'user');
            messageInput.value = '';
            isLoading = true;
            sendButton.disabled = true;
            sendButton.textContent = 'Sending...';

            // Show typing indicator
            showTyping();

            try {
                const response = await fetch('http://localhost:5002/api/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: message,
                        conversationHistory: []
                    }),
                });

                hideTyping();

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                // Add assistant response
                addMessage(data.response, 'assistant', data.sqlQuery, data.data);

            } catch (error) {
                hideTyping();
                console.error('Error sending message:', error);
                addMessage('Sorry, I encountered an error while processing your request. Please make sure the RAG service is running on port 5002.', 'assistant');
            } finally {
                isLoading = false;
                sendButton.disabled = false;
                sendButton.textContent = 'Send';
            }
        }

        function useSampleQuery(query) {
            messageInput.value = query;
            messageInput.focus();
        }

        // Handle Enter key
        messageInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 120) + 'px';
        });
    </script>
</body>
</html>


